<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RANZ Compliance Master Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --ranz-charcoal: #3c4b5d;
            --ranz-blue: #00417a;
            --ranz-red: #be4039;
            --ranz-yellow: #fcb613;
            --ranz-silver: #939598;
            --light-bg: #f4f7f6;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--light-bg);
            color: var(--ranz-charcoal);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: var(--ranz-charcoal);
            color: white;
            position: relative;
            overflow: hidden;
            height: 220px;
            padding-top: 2rem;
        }

        .header-content {
            position: relative;
            z-index: 2;
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .diagonal-accent {
            position: absolute;
            top: 0;
            right: -100px;
            width: 60%;
            height: 100%;
            background-color: var(--ranz-blue);
            transform: skewX(-20deg);
            z-index: 1;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
        }

        h1 {
            font-weight: 800;
            text-transform: uppercase;
            margin: 0;
            font-size: 2rem;
            letter-spacing: 1px;
        }

        .subtitle {
            font-weight: 300;
            font-size: 1rem;
            margin-top: 0.5rem;
            opacity: 0.9;
            max-width: 60%;
        }

        .container {
            max-width: 900px;
            margin: -50px auto 2rem;
            position: relative;
            z-index: 3;
            padding: 0 1rem;
            flex: 1;
        }

        .card {
            background: white;
            border-top: 5px solid var(--ranz-red);
            border-radius: 4px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 2.5rem;
            margin-bottom: 2rem;
            display: none;
        }

        .card.active { display: block; animation: fadeIn 0.4s ease-in-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--ranz-blue);
            font-weight: 800;
            font-size: 1.4rem;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-box, .warning-box, .case-study-box, .intro-box, .tech-alert {
            padding: 1.5rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .intro-box { background-color: white; border: 1px solid #eee; border-left: 5px solid var(--ranz-charcoal); }
        .info-box { background-color: #eef4f8; border-left: 5px solid var(--ranz-blue); }
        .warning-box { background-color: #fff3cd; border-left: 5px solid var(--ranz-yellow); color: #856404; }
        .case-study-box { background-color: #fff0f0; border-left: 5px solid var(--ranz-red); color: #721c24; }
        .tech-alert { background-color: #e3f2fd; border-left: 5px solid #2196f3; color: #0d47a1; }

        .box-title {
            font-weight: 800;
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .case-study-box .box-title::before { content: "‚öñÔ∏è CASE LAW ALERT: "; margin-right: 5px; }
        .tech-alert .box-title::before { content: "üõ†Ô∏è TECHNICAL ALERT: "; margin-right: 5px; }

        .citation {
            font-size: 0.8rem;
            margin-top: 0.8rem;
            font-style: italic;
            opacity: 0.8;
            border-top: 1px solid rgba(0,0,0,0.1);
            padding-top: 5px;
        }

        .leg-block {
            border: 1px solid #eee;
            border-left: 4px solid var(--ranz-silver);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            background: #fafafa;
        }
        .leg-question { font-weight: 800; color: var(--ranz-blue); margin-bottom: 0.5rem; font-size: 0.9rem; text-transform: uppercase; }
        .leg-ref { font-weight: 600; color: var(--ranz-charcoal); font-size: 0.95rem; }
        .leg-explain { font-size: 0.9rem; color: #555; margin-top: 0.5rem; }

        .option-group { display: grid; gap: 1rem; }

        .radio-label {
            display: block;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-label:hover { border-color: var(--ranz-silver); background-color: #fafafa; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .radio-label {
            border-color: var(--ranz-blue);
            background-color: #f0f7fb;
            box-shadow: 0 0 0 1px var(--ranz-blue);
        }

        .option-title { font-weight: 700; display: block; margin-bottom: 5px; }
        .option-desc { font-weight: 300; font-size: 0.9rem; color: #666; }

        .actions { margin-top: 2rem; display: flex; gap: 1rem; }
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 4px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 0.9rem;
            flex: 1;
        }
        .btn-next { background-color: var(--ranz-blue); color: white; }
        .btn-next:hover { background-color: #002a4d; }
        .btn-next:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .btn-back { background-color: #e9ecef; color: #333; }
        .btn-back:hover { background-color: #dbe2e8; }

        .result-banner { text-align: center; padding: 2rem; color: white; border-radius: 6px; margin-bottom: 2rem; }
        .res-consent { background-color: var(--ranz-red); }
        .res-exempt { background-color: #28a745; }
        .checklist li { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        footer { text-align: center; padding: 2rem; font-size: 0.8rem; color: #888; }
        
        /* Terms Box */
        .terms-container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 1rem;
            font-size: 0.85rem;
            color: #555;
            height: 150px;
            overflow-y: auto;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        .terms-check-wrapper {
            display: flex; align-items: center; margin-bottom: 1.5rem; padding: 1rem; background: #eef4f8; border-radius: 4px;
        }
        .terms-check-wrapper input { width: 20px; height: 20px; margin-right: 10px; display: block; }
    </style>
</head>
<body>

<header>
    <div class="diagonal-accent"></div>
    <div class="header-content">
        <h1>Compliance Wizard</h1>
        <p class="subtitle">Consent, Licensing & LBP Obligations</p>
    </div>
</header>

<div class="container">

    <div class="card active" id="stepIntro">
        <h2>Welcome to the RANZ Compliance Wizard</h2>
        <div class="intro-box">
            <p>This tool helps Roofers, LBPs, and Homeowners determine their obligations under the <strong>Building Act 2004</strong> and the <strong>LBP Rules</strong>.</p>
            <p>Throughout this tool, you will see <strong>Case Law Alerts</strong> based on real, upheld complaints.</p>
        </div>
        <h3>Terms & Conditions of Use</h3>
        <div class="terms-container">
            <p><strong>1. No Data Storage or Verification:</strong> RANZ does not see, store, or verify information entered here.</p>
            <p><strong>2. Membership Status:</strong> Usage does not imply RANZ membership. Verify at ranz.co.nz.</p>
            <p><strong>3. Not Legal Advice:</strong> This is a guide based on the Building Act 2004. Consult your BCA for specific rulings.</p>
        </div>
        <div class="terms-check-wrapper">
            <input type="checkbox" id="terms-check">
            <label for="terms-check"><strong>I have read and accept these Terms & Conditions.</strong></label>
        </div>
        <div class="actions">
            <button class="btn btn-next" id="btn-intro-start" disabled>Start Assessment</button>
        </div>
    </div>

    <div class="card" id="step0">
        <h2>Phase 1: What is your situation?</h2>
        <div class="option-group">
            <label>
                <input type="radio" name="pathway" value="planning">
                <div class="radio-label">
                    <span class="option-title">A. Planning & Pricing</span>
                    <span class="option-desc">"I am planning a job. Do I need a Consent? Are there technical risks?"</span>
                </div>
            </label>
            <label>
                <input type="radio" name="pathway" value="execution">
                <div class="radio-label">
                    <span class="option-title">B. Doing the Work / Issues</span>
                    <span class="option-desc">"I am on site, found a problem, making changes, or have a dispute."</span>
                </div>
            </label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-0">Back</button>
            <button class="btn btn-next" id="btn-start">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepP1">
        <h2>Step 1: The Job Scope</h2>
        <div class="case-study-box">
            <div class="box-title">Design Changes = No Exemption</div>
            In <em>Newton [2023]</em>, a roofer replaced a dormer but removed parapets. The Board ruled this was <strong>not</strong> "like-for-like". If you change the design, Schedule 1 does not apply.
        </div>
        <p><strong>What is the nature of the work?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="scope" value="new"><div class="radio-label"><span class="option-title">A. New Build or Extension</span><span class="option-desc">New footprint or structural extension.</span></div></label>
            <label><input type="radio" name="scope" value="replace_same"><div class="radio-label"><span class="option-title">B. Like-for-Like Replacement</span><span class="option-desc">Same position, comparable materials.</span></div></label>
            <label><input type="radio" name="scope" value="replace_change"><div class="radio-label"><span class="option-title">C. Replacement with Design Changes</span><span class="option-desc">e.g. Removing parapets, changing pitch.</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-p1">Back</button>
            <button class="btn btn-next" id="btn-next-p1">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepP1_Complex">
        <h2>Step 1b: Complex Scenarios</h2>
        <div class="tech-alert">
            <div class="box-title">Grey Areas</div>
            Some jobs look like "replacement" but trigger Code issues (E1/E2/H1).
        </div>
        <p><strong>Does the job involve any of these specific scenarios?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="complex" value="gutter"><div class="radio-label"><span class="option-title">Internal Gutter -> External Conversion</span><span class="option-desc">Changing drainage system design.</span></div></label>
            <label><input type="radio" name="complex" value="skillion"><div class="radio-label"><span class="option-title">Skillion Roof (No Cavity)</span><span class="option-desc">Re-roofing a skillion, potentially adding vents.</span></div></label>
            <label><input type="radio" name="complex" value="none"><div class="radio-label"><span class="option-title">None of the above</span><span class="option-desc">Standard re-roof or new build.</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-complex">Back</button>
            <button class="btn btn-next" id="btn-next-complex">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepP1_Age">
        <h2>Step 1c: Age & Durability</h2>
        <div class="info-box">
            <div class="box-title">The 15-Year Rule</div>
            Exemption is EXCLUDED if the component failed before its 15-year durability requirement (Clause B2).
        </div>
        <p><strong>How old is the current roof?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="age" value="old"><div class="radio-label"><span class="option-title">Over 15 Years Old</span><span class="option-desc">Normal end of life.</span></div></label>
            <label><input type="radio" name="age" value="young"><div class="radio-label"><span class="option-title">Under 15 Years Old</span><span class="option-desc">Premature failure.</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-age">Back</button>
            <button class="btn btn-next" id="btn-next-age">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepP2">
        <h2>Step 2: Consent Status</h2>
        <div class="case-study-box">
            <div class="box-title">Duty to Check</div>
            In <em>Corbett-Pearson [2024]</em>, failing to check for a consent before starting was deemed negligence by the Board.
        </div>
        <p><strong>Has a Consent been issued?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="consent_status" value="yes"><div class="radio-label"><span class="option-title">Yes, Consent Issued</span></div></label>
            <label><input type="radio" name="consent_status" value="no_check"><div class="radio-label"><span class="option-title">Unsure / Not Confirmed</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-p2">Back</button>
            <button class="btn btn-next" id="btn-next-p2">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepE1">
        <h2>Execution: Making Changes</h2>
        <div class="case-study-box">
            <div class="box-title">"My way is better" Trap</div>
            In <em>Langdon [2025]</em>, a roofer used a "better" method than the plan but didn't get approval first. He was fined $1,500.
        </div>
        <p><strong>Are you deviating from the Plans?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="variation" value="yes"><div class="radio-label"><span class="option-title">Yes</span><span class="option-desc">Changing flashings, profiles, or details.</span></div></label>
            <label><input type="radio" name="variation" value="no"><div class="radio-label"><span class="option-title">No</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-e1">Back</button>
            <button class="btn btn-next" id="btn-next-e1">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepE1_Discovery">
        <h2>Execution: Unforeseen Discovery</h2>
        <div class="tech-alert">
            <div class="box-title">Structural Upgrades</div>
            If you uncover non-compliant structure (e.g. old purlins/ply), you cannot simply cover it up.
        </div>
        <p><strong>Have you found non-compliant or damaged structure?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="discovery" value="structural"><div class="radio-label"><span class="option-title">Yes (Rotten timber, wrong fixings, old ply)</span><span class="option-desc">"I need to replace substrate/purlins."</span></div></label>
            <label><input type="radio" name="discovery" value="none"><div class="radio-label"><span class="option-title">No / Minor issues only</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-discovery">Back</button>
            <button class="btn btn-next" id="btn-next-discovery">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepE2">
        <h2>Execution: Supervision</h2>
        <div class="case-study-box">
            <div class="box-title">Remote Supervision</div>
            In <em>Horrack [2024]</em>, the Board ruled "Remote supervision does not mean NO supervision". You must physically inspect restricted building work.
        </div>
        <p><strong>How are you supervising this job?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="supervision" value="self"><div class="radio-label"><span class="option-title">I am doing it myself</span></div></label>
            <label><input type="radio" name="supervision" value="check"><div class="radio-label"><span class="option-title">Supervising others (Physical Checks)</span></div></label>
            <label><input type="radio" name="supervision" value="remote"><div class="radio-label"><span class="option-title">Remote / No Inspection</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-e2">Back</button>
            <button class="btn btn-next" id="btn-next-e2">Next Step</button>
        </div>
    </div>

    <div class="card" id="stepE3">
        <h2>Execution: Completion</h2>
        <div class="warning-box">
            <div class="box-title">Withholding Paperwork</div>
            In <em>Moyes [2025]</em>, an LBP was fined for withholding a Record of Work due to unpaid invoices.
        </div>
        <p><strong>What is the job status?</strong></p>
        <div class="option-group">
            <label><input type="radio" name="completion" value="finished"><div class="radio-label"><span class="option-title">Job Completed Normally</span></div></label>
            <label><input type="radio" name="completion" value="dispute"><div class="radio-label"><span class="option-title">Dispute / Payment Issue</span></div></label>
            <label><input type="radio" name="completion" value="terminated"><div class="radio-label"><span class="option-title">Contract Terminated / Walked Off</span></div></label>
        </div>
        <div class="actions">
            <button class="btn btn-back" id="btn-back-e3">Back</button>
            <button class="btn btn-next" id="btn-next-e3">Get Determination</button>
        </div>
    </div>

    <div class="card" id="stepResults">
        <div id="result-banner" class="result-banner"></div>
        <h3>Critical Compliance Checklist:</h3>
        <ul class="checklist" id="final-checklist"></ul>
        <div id="warnings-section" style="margin-top: 2rem;"></div>
        <div style="margin-top: 3rem; border-top: 2px solid #eee; padding-top: 2rem;">
            <h3>Legislation & Rules Breakdown</h3>
            <p style="margin-bottom:1rem; font-size:0.9rem; color:#666;">Explanation of your answers based on the Building Act 2004 and BPB Case Law.</p>
            <div id="legislation-breakdown"></div>
        </div>
        <button class="btn btn-back" style="width:100%; margin-top:2rem; background:#333; color:white;" onclick="location.reload()">Start New Assessment</button>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        var state = {
            pathway: null, scope: null, complex: null, age: null, consent_status: null,
            variation: null, discovery: null, supervision: null, completion: null
        };

        // Terms Logic
        var termsCheck = document.getElementById('terms-check');
        var startBtn = document.getElementById('btn-intro-start');
        termsCheck.addEventListener('change', function() { startBtn.disabled = !this.checked; });

        // Explanation Data
        const explanations = {
            scope: {
                question: "Scope",
                new: { ref: "Building Act 2004, s40", text: "New builds generally require consent." },
                replace_same: { ref: "Schedule 1 (Exemption 1)", text: "Exempt if comparable materials used." },
                replace_change: { ref: "Newton [2023]", text: "Design changes (e.g. removing parapets) void exemptions." }
            },
            complex: {
                question: "Complex Scenario",
                gutter: { ref: "Building Code E1/E2", text: "Internal to External gutter conversion is a design change affecting drainage. Rarely 'Like-for-Like'." },
                skillion: { ref: "Building Code H1/E3", text: "Adding vents is a design change. Not adding them risks condensation. High risk area." },
                none: { ref: "N/A", text: "Standard scope." }
            },
            age: {
                question: "15-Year Rule",
                young: { ref: "Schedule 1, Clause 1(a)(ii)", text: "No exemption if durability failed <15 years." },
                old: { ref: "Schedule 1", text: "Likely maintenance exemption." }
            },
            discovery: {
                question: "Unforeseen Structure",
                structural: { ref: "Building Act s112 & RBW", text: "Replacing purlins/substrate is Restricted Building Work. New work must meet current code (e.g. H3.2/Stainless), not old code." },
                none: { ref: "N/A", text: "No structural issues." }
            },
            consent_status: {
                question: "Consent Check",
                no_check: { ref: "Corbett-Pearson [2024]", text: "Failing to check for consent is negligence." }
            },
            variation: {
                question: "Variations",
                yes: { ref: "Langdon [2025]", text: "You cannot deviate without Form 45A approval." }
            },
            supervision: {
                question: "Supervision",
                remote: { ref: "Horrack [2024]", text: "Remote supervision requires physical inspection." }
            },
            completion: {
                question: "Completion",
                dispute: { ref: "Moyes [2025]", text: "Withholding RoW is a disciplinary offence." },
                terminated: { ref: "McKinstry [2023]", text: "Completion means when your contract ended." }
            }
        };

        function showStep(stepId) {
            var cards = document.querySelectorAll('.card');
            for(var i=0; i<cards.length; i++) { cards[i].classList.remove('active'); }
            var target = document.getElementById(stepId);
            if(target) { target.classList.add('active'); target.scrollIntoView({ behavior: 'smooth' }); }
        }

        // NAVIGATION
        document.getElementById('btn-intro-start').addEventListener('click', function() { showStep('step0'); });
        document.getElementById('btn-back-0').addEventListener('click', function() { showStep('stepIntro'); });
        
        document.getElementById('btn-start').addEventListener('click', function() {
            var el = document.querySelector('input[name="pathway"]:checked');
            if(!el) { alert("Please select a pathway."); return; }
            state.pathway = el.value;
            if(state.pathway === 'planning') showStep('stepP1'); else showStep('stepE1');
        });

        // Planning Flow
        document.getElementById('btn-back-p1').addEventListener('click', function() { showStep('step0'); });
        document.getElementById('btn-next-p1').addEventListener('click', function() {
            var el = document.querySelector('input[name="scope"]:checked');
            if(!el) { alert("Select scope."); return; }
            state.scope = el.value;
            // Always ask complex questions now
            showStep('stepP1_Complex');
        });

        document.getElementById('btn-back-complex').addEventListener('click', function() { showStep('stepP1'); });
        document.getElementById('btn-next-complex').addEventListener('click', function() {
            var el = document.querySelector('input[name="complex"]:checked');
            if(!el) { alert("Select option."); return; }
            state.complex = el.value;
            
            if(state.scope === 'replace_same') showStep('stepP1_Age'); else showStep('stepP2');
        });

        document.getElementById('btn-back-age').addEventListener('click', function() { showStep('stepP1_Complex'); });
        document.getElementById('btn-next-age').addEventListener('click', function() {
            var el = document.querySelector('input[name="age"]:checked');
            if(!el) { alert("Select age."); return; }
            state.age = el.value;
            showStep('stepP2');
        });

        document.getElementById('btn-back-p2').addEventListener('click', function() { 
            if(state.scope === 'replace_same') showStep('stepP1_Age'); else showStep('stepP1_Complex');
        });
        document.getElementById('btn-next-p2').addEventListener('click', function() {
            var el = document.querySelector('input[name="consent_status"]:checked');
            if(!el) { alert("Confirm status."); return; }
            state.consent_status = el.value;
            calculatePlanning();
        });

        // Execution Flow
        document.getElementById('btn-back-e1').addEventListener('click', function() { showStep('step0'); });
        document.getElementById('btn-next-e1').addEventListener('click', function() {
            var el = document.querySelector('input[name="variation"]:checked');
            if(!el) { alert("Answer variation."); return; }
            state.variation = el.value;
            showStep('stepE1_Discovery');
        });

        document.getElementById('btn-back-discovery').addEventListener('click', function() { showStep('stepE1'); });
        document.getElementById('btn-next-discovery').addEventListener('click', function() {
            var el = document.querySelector('input[name="discovery"]:checked');
            if(!el) { alert("Answer discovery."); return; }
            state.discovery = el.value;
            showStep('stepE2');
        });

        document.getElementById('btn-back-e2').addEventListener('click', function() { showStep('stepE1_Discovery'); });
        document.getElementById('btn-next-e2').addEventListener('click', function() {
            var el = document.querySelector('input[name="supervision"]:checked');
            if(!el) { alert("Answer supervision."); return; }
            state.supervision = el.value;
            showStep('stepE3');
        });

        document.getElementById('btn-back-e3').addEventListener('click', function() { showStep('stepE2'); });
        document.getElementById('btn-next-e3').addEventListener('click', function() {
            var el = document.querySelector('input[name="completion"]:checked');
            if(!el) { alert("Answer completion."); return; }
            state.completion = el.value;
            calculateExecution();
        });

        // RENDER HELPERS
        function renderLegislation(keys) {
            var html = "";
            keys.forEach(function(k) {
                var val = state[k];
                if(val && explanations[k] && explanations[k][val]) {
                    var d = explanations[k][val];
                    html += `<div class="leg-block"><div class="leg-question">${explanations[k].question}</div><div class="leg-ref">${d.ref}</div><div class="leg-explain">${d.text}</div></div>`;
                }
            });
            document.getElementById('legislation-breakdown').innerHTML = html;
        }

        // CALCULATE
        function calculatePlanning() {
            var reasons = [], warnings = [], isReq = false;
            var banner = document.getElementById('result-banner');

            // Complex Triggers
            if(state.complex === 'gutter') {
                isReq = true;
                reasons.push("<strong>Consent Required:</strong> Changing Internal to External gutters changes the drainage system design (E1). This is rarely exempt.");
            }
            if(state.complex === 'skillion') {
                warnings.push('<div class="tech-alert"><div class="box-title">Skillion Roof Risk</div>Re-roofing a skillion without ventilation can cause condensation. Adding vents is a design change (Consent needed).</div>');
            }

            // Scope Triggers
            if (state.scope === 'new' || state.scope === 'replace_change') isReq = true;
            else if (state.scope === 'replace_same' && state.age === 'young') isReq = true;

            // Display
            if(isReq) {
                banner.className = "result-banner res-consent";
                banner.innerHTML = "<h1>CONSENT & LBP REQUIRED</h1>";
                reasons.push("<strong>LBP Required:</strong> Restricted Building Work.");
            } else {
                banner.className = "result-banner res-exempt";
                banner.innerHTML = "<h1>LIKELY EXEMPT</h1>";
                reasons.push("<strong>No LBP Mandate:</strong> (But recommended).");
            }

            if(state.consent_status === 'no_check' && isReq) {
                warnings.push('<div class="case-study-box"><div class="box-title">DANGER</div>Failing to check for consent is negligence (<em>Corbett-Pearson</em>).</div>');
            }

            document.getElementById('final-checklist').innerHTML = reasons.map(r=>"<li>"+r+"</li>").join('');
            document.getElementById('warnings-section').innerHTML = warnings.join('');
            renderLegislation(['scope', 'complex', 'age', 'consent_status']);
            showStep('stepResults');
        }

        function calculateExecution() {
            var reasons = [], warnings = [];
            var banner = document.getElementById('result-banner');
            banner.className = "result-banner res-consent";
            banner.innerHTML = "<h1>EXECUTION ADVICE</h1>";

            if(state.variation === 'yes') {
                warnings.push('<div class="case-study-box"><div class="box-title">STOP: Variation</div>Apply for Minor Variation (Form 45A) immediately. Unapproved changes = Fines (<em>Langdon</em>).</div>');
            }

            if(state.discovery === 'structural') {
                reasons.push("<strong>Structural Finding:</strong> Replacing substrate/purlins is RBW. New work MUST meet current code (s112).");
            }

            if(state.supervision === 'remote') {
                warnings.push('<div class="case-study-box"><div class="box-title">Supervision Risk</div>Remote supervision requires physical inspection (<em>Horrack</em>).</div>');
            }

            if(state.completion === 'dispute') {
                warnings.push('<div class="case-study-box"><div class="box-title">Issue RoW Now</div>Do not withhold RoW for payment (<em>Moyes</em>).</div>');
            } else if(state.completion === 'terminated') {
                reasons.push("<strong>Action:</strong> Issue RoW for work done so far.");
            }

            reasons.push("<strong>General:</strong> Send RoW to Owner AND Council.");

            document.getElementById('final-checklist').innerHTML = reasons.map(r=>"<li>"+r+"</li>").join('');
            document.getElementById('warnings-section').innerHTML = warnings.join('');
            renderLegislation(['variation', 'discovery', 'supervision', 'completion']);
            showStep('stepResults');
        }
    });
</script>

</body>
</html>
